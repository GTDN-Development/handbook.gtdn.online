---
title: "Cookie Consent Management"
description: "Privacy-first cookie consent system for Next.js 15+ with SSR support, GDPR compliance, and seamless third-party script integration."
highlight: true
---

import { Step, Steps } from "fumadocs-ui/components/steps";

## Cookie Consent Management Structure

```
src/components/cookies/
├── cookie-context.tsx              # Client state + React Context hook
├── server-utils.ts                 # Server-side consent reading
├── third-party-scripts.tsx         # Add your GA/GTM scripts here
├── dynamic-scripts.tsx             # Auto-refresh on consent change
├── cookie-consent-banner.tsx       # Initial consent banner UI
├── cookie-settings-dialog.tsx      # Detailed preferences dialog
├── cookie-settings-trigger.tsx     # Reusable settings trigger button
├── cookie-error-boundary.tsx       # Error handling wrapper
└── cookie-policy.tsx               # Cookie policy table component
```

## Installation

<Steps>

<Step>

### Install Dependencies

```bash
npm install @next/third-parties
```

</Step>

<Step>

### Create Directory Structure

```bash
mkdir -p src/components/cookies
```

</Step>

<Step>

### Create Cookie Context

```bash
touch src/components/cookies/cookie-context.tsx
```

```tsx title="src/components/cookies/cookie-context.tsx"
"use client";

import { createContext, useContext, useState, useEffect, ReactNode } from "react";

const COOKIE_NAME = "cookie_consent";
const COOKIE_MAX_AGE = 365 * 24 * 60 * 60; // 1 year in seconds

// Enable logging of the current state and always display the consent banner
const DEBUG_MODE = false;

type ConsentState = {
  necessary: boolean;
  functional: boolean;
  analytics: boolean;
  marketing: boolean;
};

type CookieContextType = {
  // Current consent preferences
  consent: ConsentState;
  // Check if user has consented to a specific category
  hasConsentedTo: (category: keyof ConsentState) => boolean;
  // Update a specific consent category preference
  updateConsent: (category: keyof ConsentState, value: boolean) => void;
  // Save current consent preferences to storage
  saveConsent: (consentToSave?: ConsentState) => void;
  // Whether the user has interacted with the consent banner
  hasInteracted: boolean;
  // Whether the context has mounted and loaded from storage
  isMounted: boolean;
  // Whether the settings dialog is open
  isSettingsOpen: boolean;
  // Open the settings dialog
  openSettingsDialog: () => void;
  // Close the settings dialog
  closeSettingsDialog: () => void;
};

const CookieContext = createContext<CookieContextType | undefined>(undefined);

const initialConsent: ConsentState = {
  necessary: true, // Necessary cookies are always enabled
  functional: false,
  analytics: false,
  marketing: false,
};

function getConsentFromCookie(): ConsentState | null {
  if (typeof document === "undefined") {
    return null;
  }

  try {
    const cookies = document.cookie.split("; ");
    const consentCookie = cookies.find((c) => c.startsWith(`${COOKIE_NAME}=`));

    if (!consentCookie) {
      return null;
    }

    const value = consentCookie.split("=")[1];
    return JSON.parse(decodeURIComponent(value));
  } catch (error) {
    console.error("Error reading consent cookie:", error);
    return null;
  }
}

function setConsentCookie(consent: ConsentState): void {
  if (typeof document === "undefined") {
    return;
  }

  try {
    const value = encodeURIComponent(JSON.stringify(consent));
    const secure = window.location.protocol === "https:" ? "; Secure" : "";
    document.cookie = `${COOKIE_NAME}=${value}; Max-Age=${COOKIE_MAX_AGE}; Path=/; SameSite=Lax${secure}`;
  } catch (error) {
    console.error("Error setting consent cookie:", error);
  }
}

// For safety the cookie consent works normally in production
const ENABLE_DEBUG_MODE = process.env.NODE_ENV === "development" && DEBUG_MODE;

export function CookieContextProvider({ children }: { children: ReactNode }) {
  const [consent, setConsent] = useState<ConsentState>(initialConsent);
  const [isMounted, setIsMounted] = useState(false);
  const [hasInteracted, setHasInteracted] = useState(false);
  const [isSettingsOpen, setIsSettingsOpen] = useState(false);

  useEffect(() => {
    const storedConsent = getConsentFromCookie();
    const hasStored = storedConsent !== null;

    if (hasStored) {
      setConsent(storedConsent);
    }

    setHasInteracted(ENABLE_DEBUG_MODE ? false : hasStored);
    setIsMounted(true);
  }, []);

  // Debug mode: log state changes
  useEffect(() => {
    if (ENABLE_DEBUG_MODE && isMounted) {
      console.log("Cookie Consent State:", {
        consent,
        hasInteracted,
        isSettingsOpen,
      });
    }
  }, [consent, hasInteracted, isSettingsOpen, isMounted]);

  function updateConsent(category: keyof ConsentState, value: boolean) {
    if (category === "necessary") return;
    setConsent((prev) => ({ ...prev, [category]: value }));
  }

  function saveConsent(consentToSave?: ConsentState) {
    const finalConsent = consentToSave || consent;
    setConsentCookie(finalConsent);
    setConsent(finalConsent);
    setHasInteracted(true);
  }

  function hasConsentedTo(category: keyof ConsentState): boolean {
    return isMounted && consent[category];
  }

  function openSettingsDialog() {
    setIsSettingsOpen(true);
  }

  function closeSettingsDialog() {
    setIsSettingsOpen(false);
  }

  return (
    <CookieContext.Provider
      value={{
        consent,
        hasConsentedTo,
        updateConsent,
        saveConsent,
        hasInteracted,
        isMounted,
        isSettingsOpen,
        openSettingsDialog,
        closeSettingsDialog,
      }}
    >
      {children}
    </CookieContext.Provider>
  );
}

export function useCookieContext() {
  const context = useContext(CookieContext);
  if (context === undefined) {
    throw new Error("useCookieContext must be used within a CookieProvider");
  }
  return context;
}
```

</Step>

<Step>

### Create Server Utilities

```bash
touch src/components/cookies/server-utils.ts
```

```ts title="src/components/cookies/server-utils.ts"
import { cookies } from "next/headers";

export const COOKIE_NAME = "cookie_consent";

export type ConsentState = {
  necessary: boolean;
  functional: boolean;
  analytics: boolean;
  marketing: boolean;
};

const defaultConsent: ConsentState = {
  necessary: true,
  functional: false,
  analytics: false,
  marketing: false,
};

/**
 * Get cookie consent from server-side cookies
 * Use this in Server Components, Server Actions, and Route Handlers
 */
export async function getConsent(): Promise<ConsentState> {
  const cookieStore = await cookies();
  const consentCookie = cookieStore.get(COOKIE_NAME);

  if (!consentCookie?.value) {
    return defaultConsent;
  }

  try {
    const parsed = JSON.parse(decodeURIComponent(consentCookie.value));
    return {
      necessary: parsed.necessary ?? true,
      functional: parsed.functional ?? false,
      analytics: parsed.analytics ?? false,
      marketing: parsed.marketing ?? false,
    };
  } catch (error) {
    console.error("Error parsing consent cookie:", error);
    return defaultConsent;
  }
}

/**
 * Check if user has consented to a specific category
 */
export async function hasConsentedTo(category: keyof ConsentState): Promise<boolean> {
  const consent = await getConsent();
  return consent[category];
}

/**
 * Check if user has interacted with the consent banner
 */
export async function hasInteracted(): Promise<boolean> {
  const cookieStore = await cookies();
  return cookieStore.has(COOKIE_NAME);
}
```

</Step>

<Step>

### Create Third-Party Scripts Loader

```bash
touch src/components/cookies/third-party-scripts.tsx
```

```tsx title="src/components/cookies/third-party-scripts.tsx"
import { getConsent } from "./server-utils";
import { GoogleAnalytics, GoogleTagManager } from "@next/third-parties/google";

export async function ThirdPartyScripts() {
  const consent = await getConsent();

  const gaId = process.env.NEXT_PUBLIC_GA_ID;
  const gtmId = process.env.NEXT_PUBLIC_GTM_ID;

  return (
    <>
      {consent.analytics && gaId && <GoogleAnalytics gaId={gaId} />}
      {consent.analytics && gtmId && <GoogleTagManager gtmId={gtmId} />}
    </>
  );
}
```

</Step>

<Step>

### Create Dynamic Scripts Component

```bash
touch src/components/cookies/dynamic-scripts.tsx
```

```tsx title="src/components/cookies/dynamic-scripts.tsx"
"use client";

import { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useCookieContext } from "./cookie-context";

/**
 * Client component that reloads the page when consent changes
 * This ensures third-party scripts are loaded/unloaded based on new consent
 */
export function DynamicScripts() {
  const { consent, hasInteracted, isMounted } = useCookieContext();
  const router = useRouter();

  useEffect(() => {
    // Skip on initial mount
    if (!isMounted || !hasInteracted) {
      return;
    }

    // Store the current consent to detect changes
    const consentKey = "consent_change_check";
    const storedConsent = sessionStorage.getItem(consentKey);
    const currentConsent = JSON.stringify(consent);

    if (storedConsent && storedConsent !== currentConsent) {
      // Consent changed - refresh to apply new script settings
      sessionStorage.setItem(consentKey, currentConsent);
      router.refresh();
    } else if (!storedConsent) {
      // First time - just store it
      sessionStorage.setItem(consentKey, currentConsent);
    }
  }, [consent, hasInteracted, isMounted, router]);

  return null;
}
```

</Step>

<Step>

### Create Cookie Consent Banner

```bash
touch src/components/cookies/cookie-consent-banner.tsx
```

```tsx title="src/components/cookies/cookie-consent-banner.tsx"
"use client";

import { Button } from "../ui/button";
import { useCookieContext } from "./cookie-context";

export function CookieConsentBanner() {
  const { hasInteracted, isMounted, saveConsent, openSettingsDialog } = useCookieContext();

  if (!isMounted || hasInteracted) {
    return null;
  }

  function handleDeny() {
    saveConsent({
      necessary: true,
      functional: false,
      analytics: false,
      marketing: false,
    });
  }

  function handleAcceptAll() {
    saveConsent({
      necessary: true,
      functional: true,
      analytics: true,
      marketing: true,
    });
  }

  return (
    <div className="pointer-events-none fixed bottom-0 left-0 z-50 w-screen max-w-lg px-5 pb-3">
      <div className="bg-background text-foreground border-border pointer-events-auto grid w-full gap-5 rounded-xl border p-4 shadow-md dark:shadow-none">
        <div>
          <p>
            We use cookies to enhance your browsing experience, analyze site traffic, and provide
            personalized content. You can choose to accept all cookies or customize your
            preferences.
          </p>
        </div>
        <div className="flex flex-wrap items-center justify-start gap-3">
          <Button variant="secondary" size="sm" onClick={handleDeny}>
            Deny
          </Button>
          <Button variant="secondary" size="sm" onClick={handleAcceptAll}>
            Accept all
          </Button>
          <Button size="sm" className="sm:ml-auto sm:justify-self-end" onClick={openSettingsDialog}>
            Consent settings
          </Button>
        </div>
      </div>
    </div>
  );
}
```

</Step>

<Step>

### Create Cookie Settings Dialog

```bash
touch src/components/cookies/cookie-settings-dialog.tsx
```

```tsx title="src/components/cookies/cookie-settings-dialog.tsx"
"use client";

import {
  AlertDialog,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "../ui/alert-dialog";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog";
import { useCookieContext } from "./cookie-context";
import { Button } from "../ui/button";
import { Switch } from "../ui/switch";
import { Label } from "../ui/label";
import { Link } from "../ui/link";
import { legalLinks } from "@/config/legal-links";

export function CookieSettingsDialog() {
  const { consent, updateConsent, saveConsent, isSettingsOpen, closeSettingsDialog } =
    useCookieContext();

  function handleDeny() {
    saveConsent({
      necessary: true,
      functional: false,
      analytics: false,
      marketing: false,
    });
    closeSettingsDialog();
  }

  function handleAcceptAll() {
    saveConsent({
      necessary: true,
      functional: true,
      analytics: true,
      marketing: true,
    });
    closeSettingsDialog();
  }

  function handleSave() {
    saveConsent();
    closeSettingsDialog();
  }

  return (
    <AlertDialog open={isSettingsOpen} onOpenChange={closeSettingsDialog}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>Cookie Consent Settings</AlertDialogTitle>
          <AlertDialogDescription>
            Manage your cookie preferences. Blocking some cookies may impact your experience.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <div>
          <div className="border-border divide-border mt-4 divide-y rounded-lg border">
            <div className="flex flex-col gap-2 p-3">
              <div className="flex items-center justify-between gap-2">
                <Label htmlFor="necessary" className="cursor-not-allowed opacity-70">
                  Necessary
                </Label>
                <Switch
                  id="necessary"
                  checked={consent.necessary}
                  disabled
                  aria-label="Necessary cookies (always enabled)"
                />
              </div>
              <p className="text-muted-foreground text-sm opacity-70">
                Essential for the website to function. Enable basic features like page navigation
                and secure areas.
              </p>
            </div>

            <div className="flex flex-col gap-2 p-3">
              <div className="flex items-center justify-between gap-2">
                <Label htmlFor="functional" className="cursor-pointer">
                  Functional
                </Label>
                <Switch
                  id="functional"
                  checked={consent.functional}
                  onCheckedChange={(checked) => updateConsent("functional", checked as boolean)}
                  aria-label="Functional cookies"
                />
              </div>
              <p className="text-muted-foreground text-sm">
                Enable enhanced functionality and personalization, such as remembering your
                preferences and settings.
              </p>
            </div>

            <div className="flex flex-col gap-2 p-3">
              <div className="flex items-center justify-between gap-2">
                <Label htmlFor="analytics" className="cursor-pointer">
                  Analytics
                </Label>
                <Switch
                  id="analytics"
                  checked={consent.analytics}
                  onCheckedChange={(checked) => updateConsent("analytics", checked as boolean)}
                  aria-label="Analytics cookies"
                />
              </div>
              <p className="text-muted-foreground text-sm">
                Help us understand how visitors interact with our website to improve content and
                user experience.
              </p>
            </div>

            <div className="flex flex-col gap-2 p-3">
              <div className="flex items-center justify-between gap-2">
                <Label htmlFor="marketing" className="cursor-pointer">
                  Marketing
                </Label>
                <Switch
                  id="marketing"
                  checked={consent.marketing}
                  onCheckedChange={(checked) => updateConsent("marketing", checked as boolean)}
                  aria-label="Marketing cookies"
                />
              </div>
              <p className="text-muted-foreground text-sm">
                Used to deliver relevant advertisements and measure the effectiveness of advertising
                campaigns.
              </p>
            </div>
          </div>

          <div className="mt-4">
            <p className="text-muted-foreground text-sm">
              For more information about how we use cookies, please read our{" "}
              <Link
                href={legalLinks.cookies.href}
                target="_blank"
                rel="noopener noreferrer"
                className="text-foreground underline"
              >
                cookies policy.
              </Link>
            </p>
          </div>
        </div>
        <AlertDialogFooter className="mt-4">
          <AlertDialogPrimitive.Action asChild>
            <Button variant="secondary" onClick={handleDeny}>
              Deny
            </Button>
          </AlertDialogPrimitive.Action>
          <AlertDialogPrimitive.Action asChild>
            <Button variant="secondary" onClick={handleAcceptAll}>
              Accept all
            </Button>
          </AlertDialogPrimitive.Action>
          <AlertDialogPrimitive.Action asChild>
            <Button onClick={handleSave}>Save</Button>
          </AlertDialogPrimitive.Action>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
```

</Step>

<Step>

### Create Cookie Settings Trigger

```bash
touch src/components/cookies/cookie-settings-trigger.tsx
```

```tsx title="src/components/cookies/cookie-settings-trigger.tsx"
"use client";

import { useCookieContext } from "./cookie-context";

type CookieSettingsTriggerProps = React.ComponentProps<"button">;

export function CookieSettingsTrigger({ children, ...props }: CookieSettingsTriggerProps) {
  const { openSettingsDialog } = useCookieContext();

  return (
    <button type="button" onClick={openSettingsDialog} {...props}>
      {children}
    </button>
  );
}
```

</Step>

<Step>

### Create Cookie Error Boundary

```bash
touch src/components/cookies/cookie-error-boundary.tsx
```

```tsx title="src/components/cookies/cookie-error-boundary.tsx"
"use client";

import { Component, ReactNode } from "react";

type Props = {
  children: ReactNode;
  fallback?: ReactNode;
};

type State = {
  hasError: boolean;
};

export class CookieErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError() {
    return { hasError: true };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error("Cookie consent error:", error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || null;
    }

    return this.props.children;
  }
}
```

</Step>

<Step>

### Create Cookie Policy Component

```bash
touch src/components/cookies/cookie-policy.tsx
```

```tsx title="src/components/cookies/cookie-policy.tsx"
import { CookieSettingsTrigger } from "./cookie-settings-trigger";

// Define the shape of a single cookie object
type CookieCategory = "essential" | "functional" | "analytics" | "marketing";

export type Cookie = {
  name: string;
  provider: string;
  purpose: string;
  duration: string;
  category: CookieCategory;
  storageType?: "cookie" | "localStorage" | "sessionStorage";
};

type Locale = "cs" | "en";

// Define the component's props
type CookiePolicyProps = React.ComponentProps<"div"> & {
  /** Company information */
  company: {
    name: string;
    address: string;
    id: string;
    domain: string;
  };
  /** Contact information */
  contact: {
    email: string;
    phone?: string;
  };
  /** Array of cookie objects to display in the policy */
  cookies?: Cookie[];
  /** Last updated date of the document */
  lastUpdated?: string;
  /** Effective date of the document */
  effectiveDate?: string;
  /** Language of the statement ("cs" or "en") */
  locale?: Locale;
  /** Optional node for custom info on managing cookies (e.g., a button to open settings) */
  cookieManagementInfo?: React.ReactNode;
};

// Default data (example cookies) if none are provided
const defaultData: Record<Locale, { cookies: Cookie[] }> = {
  cs: {
    cookies: [
      {
        name: "_ga",
        provider: "Google Analytics",
        purpose: "Používá se k rozlišení uživatelů pro statistické účely.",
        duration: "2 roky",
        category: "analytics",
        storageType: "cookie",
      },
    ],
  },
  en: {
    cookies: [
      {
        name: "_ga",
        provider: "Google Analytics",
        purpose: "Used to distinguish users for statistical purposes.",
        duration: "2 years",
        category: "analytics",
        storageType: "cookie",
      },
    ],
  },
};

// All static text and translations
const translations = {
  cs: {
    title: "Zásady používání souborů cookie",
    effectiveFrom: "Účinné od:",
    lastUpdated: "Poslední aktualizace:",
    introTitle: "1. Úvod",
    introText:
      "Tyto Zásady používání souborů cookie vysvětlují, jaké soubory cookie používáme na našich webových stránkách",
    whatAreCookiesTitle: "2. Co jsou soubory cookie?",
    whatAreCookiesText:
      "Soubory cookie jsou malé textové soubory, které se ukládají do vašeho zařízení (počítače, mobilního telefonu) při návštěvě webových stránek. Kromě cookies můžeme také používat localStorage a sessionStorage pro ukládání dat přímo ve vašem prohlížeči. Pomáhají nám zajistit správné fungování stránek, zvýšit jejich bezpečnost, analyzovat návštěvnost a zlepšovat uživatelský komfort.",
    howWeUseCookiesTitle: "3. Jak používáme soubory cookie?",
    howWeUseCookiesText:
      "Naše webové stránky používají soubory cookie první strany i třetích stran pro několik účelů. Soubory cookie první strany jsou většinou nezbytné pro správné fungování webu a neshromažďují žádné vaše osobní údaje. Soubory cookie třetích stran používáme především k analýze návštěvnosti, marketingovým účelům a integraci sociálních médií.",
    typesOfCookiesTitle: "4. Typy souborů cookie, které používáme",
    tableHeadName: "Název",
    tableHeadProvider: "Poskytovatel",
    tableHeadPurpose: "Účel",
    tableHeadDuration: "Doba platnosti",
    tableHeadStorageType: "Typ úložiště",
    category: {
      essential: "Nezbytné soubory cookie",
      functional: "Funkční soubory cookie",
      analytics: "Analytické soubory cookie",
      marketing: "Marketingové soubory cookie",
    },
    manageTitle: "5. Jak spravovat preference úložišť?",
    manageText:
      "Své preference můžete kdykoli změnit pomocí tlačítka níže nebo prostřednictvím nastavení vašeho webového prohlížeče. Můžete blokovat nebo mazat soubory cookie, localStorage i sessionStorage data. Upozorňujeme, že omezení těchto technologií může ovlivnit funkčnost těchto webových stránek.",
    manageButton: "Změnit nastavení cookies",
    contactTitle: "6. Kontaktujte nás",
    contactText:
      "Pokud máte jakékoli dotazy týkající se těchto zásad, můžete nás kontaktovat na e-mailové adrese:",
    contactPhone: "nebo na telefonním čísle:",
  },
  en: {
    title: "Cookie Policy",
    effectiveFrom: "Effective from:",
    lastUpdated: "Last updated:",
    introTitle: "1. Introduction",
    introText: "This Cookie Policy explains what cookies are and how we use them on our website",
    whatAreCookiesTitle: "2. What Are Cookies?",
    whatAreCookiesText:
      "Cookies are small text files that are stored on your device (computer, mobile phone) when you visit a website. In addition to cookies, we may also use localStorage and sessionStorage to store data directly in your browser. They help us ensure the website functions correctly, make it more secure, understand how it performs, and analyze what works and where it needs improvement.",
    howWeUseCookiesTitle: "3. How We Use Cookies",
    howWeUseCookiesText:
      "Our website uses first-party and third-party cookies for several purposes. First-party cookies are mostly necessary for the website to function the right way, and they do not collect any of your personally identifiable data. The third-party cookies used on our website are mainly for understanding how the website performs, how you interact with our website, keeping our services secure, providing advertisements that are relevant to you, and all in all providing you with a better and improved user experience.",
    typesOfCookiesTitle: "4. Types of Cookies We Use",
    tableHeadName: "Name",
    tableHeadProvider: "Provider",
    tableHeadPurpose: "Purpose",
    tableHeadDuration: "Duration",
    tableHeadStorageType: "Storage Type",
    category: {
      essential: "Essential Cookies",
      functional: "Functional Cookies",
      analytics: "Analytics Cookies",
      marketing: "Marketing Cookies",
    },
    manageTitle: "5. How to Manage Your Cookie Preferences",
    manageText:
      "You can manage your cookie preferences at any time using the button below or through your web browser settings. You can block or delete cookies as you wish. Please be aware that restricting cookies may impact the functionality of this website.",
    manageButton: "Change Cookie Settings",
    contactTitle: "6. Contact Us",
    contactText: "If you have any questions about this Cookie Policy, you can contact us at:",
    contactPhone: "or by phone:",
  },
};

export function CookiePolicy({
  company,
  contact,
  cookies,
  lastUpdated,
  effectiveDate,
  locale = "cs",
  cookieManagementInfo,
  ...props
}: CookiePolicyProps) {
  const t = translations[locale];
  const defaults = defaultData[locale];

  // Use provided cookies or fallback to default examples
  const actualCookies = cookies || defaults.cookies;

  // Group cookies by category for structured display
  const groupedCookies = actualCookies.reduce(
    (acc, cookie) => {
      acc[cookie.category] = acc[cookie.category] || [];
      acc[cookie.category].push(cookie);
      return acc;
    },
    {} as Record<CookieCategory, Cookie[]>
  );

  return (
    <div {...props}>
      {effectiveDate && (
        <p className="text-sm opacity-60">
          {t.effectiveFrom} {effectiveDate}
        </p>
      )}
      {lastUpdated && (
        <p className="text-sm opacity-60">
          {t.lastUpdated} {lastUpdated}
        </p>
      )}

      <section>
        <h2>{t.introTitle}</h2>
        <p>
          {t.introText} <strong>{company.domain}</strong>.
        </p>
      </section>

      <section>
        <h2>{t.whatAreCookiesTitle}</h2>
        <p>{t.whatAreCookiesText}</p>
      </section>

      <section>
        <h2>{t.howWeUseCookiesTitle}</h2>
        <p>{t.howWeUseCookiesText}</p>
      </section>

      <section>
        <h2>{t.typesOfCookiesTitle}</h2>
        {(Object.keys(groupedCookies) as CookieCategory[]).map((category) => (
          <div key={category} className="mb-8">
            <h3>{t.category[category]}</h3>
            <div className="overflow-x-auto">
              <table>
                <thead>
                  <tr>
                    <th>{t.tableHeadName}</th>
                    <th>{t.tableHeadProvider}</th>
                    <th>{t.tableHeadPurpose}</th>
                    <th>{t.tableHeadDuration}</th>
                    <th>{t.tableHeadStorageType}</th>
                  </tr>
                </thead>
                <tbody>
                  {groupedCookies[category].map((cookie) => (
                    <tr key={cookie.name}>
                      <td>{cookie.name}</td>
                      <td>{cookie.provider}</td>
                      <td>{cookie.purpose}</td>
                      <td>{cookie.duration}</td>
                      <td>{cookie.storageType || "cookie"}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        ))}
      </section>

      <section>
        <h2>{t.manageTitle}</h2>
        <p>{t.manageText}</p>
        <div className="mt-4">
          <CookieSettingsTrigger className="cursor-pointer font-medium underline underline-offset-2">
            {t.manageButton}
          </CookieSettingsTrigger>
        </div>
        {cookieManagementInfo && <div className="mt-4">{cookieManagementInfo}</div>}
      </section>

      <section>
        <h2>{t.contactTitle}</h2>
        <p>
          {t.contactText} <strong>{contact.email}</strong>
          {contact.phone && (
            <>
              {" "}
              {t.contactPhone} <strong>{contact.phone}</strong>
            </>
          )}
          .
        </p>
      </section>
    </div>
  );
}
```

</Step>

<Step>

### Setup Environment Variables

Create or update your `.env.local` file:

```bash
touch .env.local
```

```tsx title=".env.local"
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
NEXT_PUBLIC_GTM_ID=GTM-XXXXXXX
```

</Step>

<Step>

### Add Context Provider

Update your providers file to include the cookie context:

```tsx title="src/components/layout/providers.tsx"
"use client";

import { CookieContextProvider } from "@/components/cookies/cookie-context";

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <CookieContextProvider>
      {children}
    </CookieContextProvider>
  );
}
```

</Step>

<Step>

### Update Root Layout

Add all cookie components to your root layout:

```tsx title="src/app/layout.tsx"
import { Suspense } from "react";
import { Providers } from "@/components/layout/providers";
import { CookieConsentBanner } from "@/components/cookies/cookie-consent-banner";
import { CookieSettingsDialog } from "@/components/cookies/cookie-settings-dialog";
import { CookieErrorBoundary } from "@/components/cookies/cookie-error-boundary";
import { DynamicScripts } from "@/components/cookies/dynamic-scripts";
import { ThirdPartyScripts } from "@/components/cookies/third-party-scripts";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>
        <Providers>
          {children}

          {/* Cookie consent UI */}
          <CookieErrorBoundary>
            <CookieConsentBanner />
            <CookieSettingsDialog />
            <DynamicScripts />
          </CookieErrorBoundary>
        </Providers>

        {/* Third-party scripts (GA, GTM, etc.) */}
        <Suspense fallback={null}>
          <ThirdPartyScripts />
        </Suspense>
      </body>
    </html>
  );
}
```

</Step>

</Steps>

## Usage

### Client Components

Use the `useCookieContext()` hook to access consent state:

```tsx
"use client";
import { useCookieContext } from "@/components/cookies/cookie-context";

function MyComponent() {
  const { hasConsentedTo, openSettingsDialog } = useCookieContext();

  if (hasConsentedTo("analytics")) {
    // Load analytics
  }

  return <button onClick={openSettingsDialog}>Cookie Settings</button>;
}
```

### Server Components

Use server utilities to check consent in Server Components:

```tsx
import { getConsent, hasConsentedTo } from "@/components/cookies/server-utils";

async function MyPage() {
  const consent = await getConsent();
  const hasAnalytics = await hasConsentedTo("analytics");

  return <div>{hasAnalytics ? "Tracking on" : "Tracking off"}</div>;
}
```

### Settings Button (Footer)

Add a settings trigger button to your footer:

```tsx
import { CookieSettingsTrigger } from "@/components/cookies/cookie-settings-trigger";

<CookieSettingsTrigger className="cursor-pointer underline">
  Cookie Settings
</CookieSettingsTrigger>
```

## Consent Categories

- **necessary** - Always on (auth, session)
- **functional** - Theme, language preferences
- **analytics** - GA, GTM, usage tracking
- **marketing** - Ads, remarketing pixels

## Cookie Policy Page

Create a cookie policy page to display all cookies:

```tsx title="src/app/cookies/page.tsx"
import { CookiePolicy } from "@/components/cookies/cookie-policy";

export default function CookiePolicyPage() {
  return (
    <div className="container max-w-4xl py-12">
      <CookiePolicy
        company={{
          name: "Your Company",
          address: "123 Main St, City, Country",
          id: "12345678",
          domain: "example.com",
        }}
        contact={{
          email: "privacy@example.com",
          phone: "+1 234 567 890",
        }}
        lastUpdated="January 12, 2026"
        effectiveDate="January 1, 2026"
        locale="en" // or "cs" for Czech
      />
    </div>
  );
}
```

## How It Works

1. **First visit** → No cookie → Banner shows
2. **User chooses** → Cookie saved → Page refreshes
3. **Scripts load** based on consent
4. **Return visits** → Scripts render server-side

## Debug Mode

Always show banner in development:

```tsx
// cookie-context.tsx (line ~8)
const DEBUG_MODE = true;
```

## Troubleshooting

**Banner not showing?** Delete `cookie_consent` cookie to test

**Scripts not loading?** Check env vars and consent in DevTools → Application → Cookies

**Hydration errors?** Check `isMounted` before rendering consent-dependent content
